"use strict";(self["webpackChunkstu_project"]=self["webpackChunkstu_project"]||[]).push([[186],{10186:function(t,e,s){s.r(e),s.d(e,{default:function(){return h}});var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"board"},[s("ul",{staticClass:"tools"},[s("li",{on:{click:t.brush}},[s("span",{staticClass:"iconfont lx-huabi",class:[0==t.index?"active":""]},[t._v("笔")])]),s("li",{on:{click:t.canvasMoveClick}},[s("span",{staticClass:"iconfont",class:[1==t.index?"active":""]},[s("a-icon",{attrs:{type:"drag"}}),t._v("移动")],1)]),s("li",{on:{click:t.eraserClick}},[s("span",{staticClass:"iconfont lx-xiangpica",class:[2==t.index?"active":""]},[t._v("笔擦")])]),s("li",{on:{click:function(e){return t.canvasRotate(0)}}},[s("span",{staticClass:"iconfont",class:[3==t.index?"active":""]},[s("a-icon",{attrs:{type:"undo"}}),t._v("左转")],1)]),s("li",{on:{click:function(e){return t.canvasRotate(1)}}},[s("span",{staticClass:"iconfont",class:[4==t.index?"active":""]},[s("a-icon",{attrs:{type:"redo"}}),t._v("右转")],1)]),s("li",{on:{click:function(e){return t.Zoom(0)}}},[s("span",{staticClass:"iconfont",class:[5==t.index?"active":""]},[s("a-icon",{attrs:{type:"zoom-in"}}),t._v("放大")],1)]),s("li",{on:{click:function(e){return t.Zoom(1)}}},[s("span",{staticClass:"iconfont",class:[6==t.index?"active":""]},[s("a-icon",{attrs:{type:"zoom-out"}}),t._v("缩小")],1)]),s("li",{on:{click:t.clearCanvas}},[s("span",{staticClass:"iconfont lx-clear"},[t._v("清屏")])]),s("li",{on:{click:t.savebtn}},[s("span",{staticClass:"iconfont lx-save"},[t._v("保存")])])]),s("div",{staticClass:"canvasBox"},[s("canvas",{ref:"canvasRef",staticClass:"cursor",on:{mousedown:function(e){return t.mousedown(e)},mousemove:function(e){return t.mousemove(e)},mouseleave:function(e){t.painting=!1},mouseup:function(e){t.painting=!1},touchstart:function(e){return t.mousedown(e)},touchmove:function(e){return t.mousemove(e)},touchend:function(e){t.painting=!1}}})])])},i=[],n=s(68354),o={name:"DrawingBoard",props:["reviewImg","stuImg","dd"],data(){return{canvas:null,ctx:null,startPoint:{x:void 0,y:void 0},painting:!1,canvasMove:!1,EraserEnabled:!1,lineWidth:4,width:0,height:0,rotate:0,scale:1,issave:!1,index:0==sessionStorage.getItem("selfReadOverSwitch")?1:0,w:1,h:1}},created(){this.$nextTick((()=>{this.canvas=this.$refs.canvasRef,this.ctx=this.canvas.getContext("2d"),this.imgLoad()}))},computed:{isMobile(){return"ontouchstart"in document.documentElement}},mounted(){let t=this;setTimeout((()=>{0==this.index?t.brush():t.canvasMoveClick()}),500)},methods:{imgLoad(){let t=new Image;t.crossOrigin="Anonymous",t.src=this.reviewImg,t.onload=()=>{const e=document.querySelector(".canvasBox").offsetHeight,s=document.querySelector(".canvasBox").offsetWidth;let a=t.width,i=t.height;this.canvas.width=a,this.canvas.height=i,this.width=t.naturalWidth,this.height=t.naturalHeight,this.canvas.style.backgroundImage=`url(${this.stuImg})`,this.ctx.drawImage(t,0,0,a,i),(a>s||i>e)&&(this.scale=Math.min(s/a,e/i),this.canvas.style.transform=`translateZ(0) scale(${this.scale})`)}},mousedown(t){t.preventDefault();let e=this;if(this.canvasMove)if(this.painting=!1,this.isMobile){let s=t.touches[0].pageX-e.canvas.offsetLeft,a=t.touches[0].pageY-e.canvas.offsetTop,i=t=>{e.canvas.style.left=t.touches[0].pageX-s+"px",e.canvas.style.top=t.touches[0].pageY-a+"px"};document.addEventListener("touchmove",i,!1),document.addEventListener("touchend",(()=>{document.removeEventListener("touchmove",i,!1),document.removeEventListener("touchend",i,!1)}),!1)}else{let s=t.pageX-e.canvas.offsetLeft,a=t.pageY-e.canvas.offsetTop;document.onmousemove=function(t){e.canvas.style.left=t.pageX-s+"px",e.canvas.style.top=t.pageY-a+"px"},document.onmouseup=function(){document.onmousemove=document.onmouseup=null}}else{let e=t.offsetX||t.touches[0].clientX-this.canvas.getBoundingClientRect().left,s=t.offsetY||t.touches[0].clientY-this.canvas.getBoundingClientRect().top;this.painting=!0,this.EraserEnabled&&this.ctx.clearRect(e-15,s-15,30,30),this.startPoint={x:e,y:s}}},mousemove(t){let e=sessionStorage.getItem("selfReadOverSwitch");if(0!=e&&!this.canvasMove){let e=t.offsetX||t.touches[0].clientX-this.canvas.getBoundingClientRect().left,s=t.offsetY||t.touches[0].clientY-this.canvas.getBoundingClientRect().top,a={x:e,y:s};this.painting&&(this.$parent.setHandwriting(!0),this.EraserEnabled?this.ctx.clearRect(e-15,s-15,30,30):this.drawLine(this.startPoint.x,this.startPoint.y,a.x,a.y),this.startPoint=a)}},mouseup(){this.painting=!1},drawLine(t,e,s,a){let i=this.ctx;i.strokeStyle="red",i.lineWidth=this.lineWidth/this.scale,i.lineJoin="round",i.beginPath(),this.isMobile?(i.moveTo(t/this.scale,e/this.scale),i.lineTo(s/this.scale,a/this.scale)):(i.moveTo(t,e),i.lineTo(s,a)),i.closePath(),i.stroke()},brush(){let t=sessionStorage.getItem("selfReadOverSwitch");0!=t&&(this.index=0,this.EraserEnabled=!1,this.canvasMove=!1,this.canvas.classList.remove("xiangpica"),this.canvas.classList.remove("moveCanvas"))},canvasMoveClick(){this.index=1,this.canvasMove=!0,this.painting=!1,this.canvas.classList.add("moveCanvas")},eraserClick(){let t=sessionStorage.getItem("selfReadOverSwitch");0!=t&&(this.index=2,this.EraserEnabled=!0,this.canvasMove=!1,this.canvas.classList.remove("moveCanvas"),this.canvas.classList.add("xiangpica"))},canvasRotate(t){this.index=3+t,1===t?(this.rotate+=90,this.applyTransform()):(this.rotate-=90,this.applyTransform())},Zoom(t){this.index=5+t,0==t?(this.scale+=.15,this.scale>2&&(this.scale=2),this.applyTransform()):(this.scale-=.15,this.scale<.1&&(this.scale=.1),this.applyTransform())},applyTransform(t=!1){if(this.canvas.style.transformOrigin="center",t)return this.scale=1,void(this.canvas.style.transform=`translateZ(0) rotate(${this.rotate}deg) scale(1,1)`);this.canvas.style.transform=`translateZ(0) rotate(${this.rotate}deg) scale(${this.scale},${this.scale})`},clearCanvas(){let t=sessionStorage.getItem("selfReadOverSwitch");0!=t&&(this.$parent.setHandwriting(!1),this.imgLoad())},save(t){let e=this;this.canvas.toBlob((s=>{e.resizeImage(s,e.width,e.height,(s=>{(0,n.ir)(s).then((s=>{t(e.blobToFile(s,(new Date).getTime()+".png"))}))}))}))},resizeImage(t,e,s,a){var i=new Image;i.src=URL.createObjectURL(t),i.onload=function(){var n=i.width,o=i.height;if(n!==e||o!==s){var c=n,l=o;(n>e||n<e)&&(c=e,l=o/n*e),(l>s||c<s)&&(c=c/l*s,l=s);var r=document.createElement("canvas");r.width=c,r.height=l;var h=r.getContext("2d");h.drawImage(i,0,0,c,l),r.toBlob((function(t){a(t)}),t.type)}else a(t)}},savebtn(){let t=sessionStorage.getItem("selfReadOverSwitch");if(0==t)return;let e=this.dd;this.$parent.Readover(e.questionId,e.source,e.judgeTag)},blobToFile(t,e){return new File([t],e,{type:"image/png",lastModified:Date.now()})}}},c=o,l=s(70713),r=(0,l.Z)(c,a,i,!1,null,"79a3a562",null),h=r.exports}}]);